
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced M√∂bius Sum Distribution Visualizer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.18.0/plotly.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
        }

        function exportChartSVG() {
            console.log('Exporting charts as SVG...');
            if (!computedData.N) {
                alert('Please generate visualization first!');
                return;
            }

            const canvases = ['spectrumChart', 'majorChart', 'histogramChart'];
            
            let exportCount = 0;
            
            canvases.forEach((canvasId, index) => {
                const canvas = document.getElementById(canvasId);
                const container = canvas?.closest('.chart-container');
                
                if (canvas && container && container.style.display !== 'none') {
                    setTimeout(() => {
                        try {
                            // Get the chart instance
                            const chart = charts[canvasId.replace('Chart', '')];
                            if (!chart) return;
                            
                            // Create SVG from canvas
                            const ctx = canvas.getContext('2d');
                            const svgString = canvasToSVG(canvas, chart);
                            
                            const blob = new Blob([svgString], { type: 'image/svg+xml' });
                            const url = URL.createObjectURL(blob);
                            
                            const link = document.createElement('a');
                            link.download = `${canvasId}_N${computedData.N}_${new Date().toISOString().split('T')[0]}.svg`;
                            link.href = url;
                            link.click();
                            
                            URL.revokeObjectURL(url);
                            exportCount++;
                            console.log(`Exported ${canvasId} as SVG`);
                        } catch (error) {
                            console.error(`Failed to export ${canvasId} as SVG:`, error);
                        }
                    }, index * 300);
                }
            });
            
            if (exportCount === 0) {
                setTimeout(() => {
                    alert('No visible charts to export. Please generate visualizations first.');
                }, 100);
            }
        }

        // Simple Canvas to SVG converter
        function canvasToSVG(canvas, chart) {
            const width = canvas.width;
            const height = canvas.height;
            
            let svgContent = `<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="${width}" height="${height}" viewBox="0 0 ${width} ${height}">
    <rect width="100%" height="100%" fill="white"/>
    <image href="${canvas.toDataURL()}" width="${width}" height="${height}"/>
</svg>`;
            
            return svgContent;
        }

        function exportChartJPEG() {
            console.log('Exporting charts as JPEG...');
            if (!computedData.N) {
                alert('Please generate visualization first!');
                return;
            }

            const canvases = ['spectrumChart', 'majorChart', 'histogramChart', 'polarChart'];
            const plotlyDivs = ['heatmapPlot', 'surface3dPlot', 'waterfallPlot'];
            
            let exportCount = 0;
            
            // Export Canvas charts as JPEG
            canvases.forEach((canvasId, index) => {
                const canvas = document.getElementById(canvasId);
                const container = canvas?.closest('.chart-container');
                
                if (canvas && container && container.style.display !== 'none') {
                    setTimeout(() => {
                        try {
                            // Create white background
                            const tempCanvas = document.createElement('canvas');
                            const tempCtx = tempCanvas.getContext('2d');
                            tempCanvas.width = canvas.width;
                            tempCanvas.height = canvas.height;
                            
                            // Fill with white background
                            tempCtx.fillStyle = '#FFFFFF';
                            tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
                            
                            // Draw original canvas on top
                            tempCtx.drawImage(canvas, 0, 0);
                            
                            const link = document.createElement('a');
                            link.download = `${canvasId}_N${computedData.N}_${new Date().toISOString().split('T')[0]}.jpeg`;
                            link.href = tempCanvas.toDataURL('image/jpeg', 0.9);
                            link.click();
                            
                            exportCount++;
                            console.log(`Exported ${canvasId} as JPEG`);
                        } catch (error) {
                            console.error(`Failed to export ${canvasId}:`, error);
                        }
                    }, index * 500);
                }
            });

            // Export Plotly charts as JPEG
            plotlyDivs.forEach((divId, index) => {
                const div = document.getElementById(divId);
                const container = div?.closest('.chart-container');
                
                if (div && container && container.style.display !== 'none') {
                    setTimeout(() => {
                        try {
                            Plotly.toImage(div, {
                                format: 'jpeg',
                                width: 1200,
                                height: 800,
                                quality: 0.9
                            }).then(function(url) {
                                const link = document.createElement('a');
                                link.download = `${divId}_N${computedData.N}_${new Date().toISOString().split('T')[0]}.jpeg`;
                                link.href = url;
                                link.click();
                                
                                exportCount++;
                                console.log(`Exported ${divId} as JPEG`);
                            }).catch(function(error) {
                                console.error(`Failed to export ${divId}:`, error);
                            });
                        } catch (error) {
                            console.error(`Failed to export ${divId}:`, error);
                        }
                    }, (canvases.length + index) * 500);
                }
            });
            
            if (exportCount === 0) {
                setTimeout(() => {
                    alert('No visible charts to export. Please generate visualizations first.');
                }, 100);
            }
        }

        // Advanced Visualization Functions
        async function createHeatMap(alphas, values, majorData, majorLabels) {
            // Create 2D grid for heat map
            const gridSize = Math.ceil(Math.sqrt(alphas.length));
            const zData = [];
            
            for (let i = 0; i < gridSize; i++) {
                const row = [];
                for (let j = 0; j < gridSize; j++) {
                    const idx = i * gridSize + j;
                    row.push(idx < values.length ? values[idx] : 0);
                }
                zData.push(row);
            }

            const data = [{
                z: zData,
                type: 'heatmap',
                colorscale: [
                    [0, '#440154'],
                    [0.2, '#31688e'],
                    [0.4, '#35b779'],
                    [0.6, '#fde725'],
                    [1, '#ff6b6b']
                ],
                showscale: true,
                colorbar: {
                    title: '|S(N,Œ±)|',
                    titleside: 'right'
                }
            }];

            const layout = {
                title: 'M√∂bius Sum Magnitude Heat Map',
                xaxis: { title: 'Œ± Index' },
                yaxis: { title: 'Œ± Index' },
                font: { family: 'Segoe UI' }
            };

            Plotly.newPlot('heatmapPlot', data, layout, {responsive: true});
        }

        async function create3DSurface(alphas, values, sqrtN) {
            // Create 3D surface data
            const gridSize = Math.ceil(Math.sqrt(alphas.length));
            const zData = [];
            const xData = [];
            const yData = [];
            
            for (let i = 0; i < gridSize; i++) {
                const zRow = [];
                const xRow = [];
                const yRow = [];
                for (let j = 0; j < gridSize; j++) {
                    const idx = i * gridSize + j;
                    zRow.push(idx < values.length ? values[idx] : 0);
                    xRow.push(idx < alphas.length ? alphas[idx] : 0);
                    yRow.push(i / gridSize);
                }
                zData.push(zRow);
                xData.push(xRow);
                yData.push(yRow);
            }

            const surfaceData = [{
                x: xData,
                y: yData,
                z: zData,
                type: 'surface',
                colorscale: 'Viridis',
                showscale: true,
                colorbar: {
                    title: '|S(N,Œ±)|',
                    titleside: 'right'
                }
            }];

            // Add ‚àöN reference plane
            const refPlane = [{
                x: 0, 1], [0, 1,
                y: 0, 0], [1, 1,
                z: sqrtN, sqrtN], [sqrtN, sqrtN,
                type: 'surface',
                opacity: 0.3,
                colorscale: 0, 'red'], [1, 'red',
                showscale: false,
                name: '‚àöN Reference'
            }];

            const layout = {
                title: '3D M√∂bius Sum Surface',
                scene: {
                    xaxis: { title: 'Œ±' },
                    yaxis: { title: 'Secondary Dimension' },
                    zaxis: { title: '|S(N,Œ±)|' },
                    camera: {
                        eye: { x: 1.5, y: 1.5, z: 1.5 }
                    }
                },
                font: { family: 'Segoe UI' }
            };

            Plotly.newPlot('surface3dPlot', [...surfaceData, ...refPlane], layout, {responsive: true});
        }

        function createPolarChart(alphas, values, sqrtN) {
            const ctx = document.getElementById('polarChart').getContext('2d');
            
            if (charts.polar) charts.polar.destroy();
            
            // Convert to polar coordinates
            const polarData = alphas.map((alpha, i) => ({
                x: values[i] * Math.cos(2 * Math.PI * alpha),
                y: values[i] * Math.sin(2 * Math.PI * alpha)
            }));

            charts.polar = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'M√∂bius Sums (Polar)',
                        data: polarData,
                        backgroundColor: 'rgba(102, 126, 234, 0.6)',
                        borderColor: 'rgb(102, 126, 234)',
                        pointRadius: 3
                    }, {
                        label: '‚àöN Circle',
                        data: Array.from({length: 360}, (_, i) => ({
                            x: sqrtN * Math.cos(i * Math.PI / 180),
                            y: sqrtN * Math.sin(i * Math.PI / 180)
                        })),
                        backgroundColor: 'rgba(231, 76, 60, 0.3)',
                        borderColor: 'rgb(231, 76, 60)',
                        pointRadius: 1,
                        showLine: true,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { 
                            type: 'linear',
                            position: 'center',
                            title: { display: true, text: 'Real Component' }
                        },
                        y: { 
                            type: 'linear',
                            position: 'center',
                            title: { display: true, text: 'Imaginary Component' }
                        }
                    },
                    plugins: {
                        legend: { display: true }
                    }
                }
            });
        }

        async function createWaterfallPlot(alphas, values) {
            // Create waterfall/ridgeline plot
            const numRidges = 10;
            const ridgeSize = Math.floor(alphas.length / numRidges);
            const traces = [];

            for (let i = 0; i < numRidges; i++) {
                const start = i * ridgeSize;
                const end = Math.min(start + ridgeSize, alphas.length);
                const ridgeAlphas = alphas.slice(start, end);
                const ridgeValues = values.slice(start, end);

                traces.push({
                    x: ridgeAlphas,
                    y: ridgeValues.map(v => v + i * 2), // Offset each ridge
                    type: 'scatter',
                    mode: 'lines',
                    fill: 'tonexty',
                    fillcolor: `rgba(${102 + i * 15}, ${126 + i * 10}, ${234 - i * 10}, 0.6)`,
                    line: { color: `rgb(${102 + i * 15}, ${126 + i * 10}, ${234 - i * 10})` },
                    name: `Ridge ${i + 1}`,
                    showlegend: false
                });
            }

            const layout = {
                title: 'Waterfall Analysis of M√∂bius Sums',
                xaxis: { title: 'Œ±' },
                yaxis: { title: '|S(N,Œ±)| + Offset' },
                font: { family: 'Segoe UI' }
            };

            Plotly.newPlot('waterfallPlot', traces, layout, {responsive: true});
        }

        // Export functions
        function downloadCSV(data, filename) {
            const blob = new Blob([data], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }

        function downloadJSON(data, filename) {
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }

        function exportMobiusData() {
            console.log('Exporting M√∂bius data...');
            if (!computedData.mu) {
                alert('Please generate visualization first!');
                return;
            }

            let csv = 'n,mobius_value,is_square_free\n';
            for (let n = 1; n <= computedData.N; n++) {
                const isSquareFree = computedData.mu[n] !== 0;
                csv += `${n},${computedData.mu[n]},${isSquareFree}\n`;
            }

            downloadCSV(csv, `mobius_values_N${computedData.N}_${new Date().toISOString().split('T')[0]}.csv`);
            console.log('M√∂bius CSV download initiated');
        }

        function exportSpectrumData() {
            console.log('Exporting spectrum data...');
            if (!computedData.spectrumData) {
                alert('Please generate visualization first!');
                return;
            }

            let csv = 'alpha,sum_magnitude,alpha_decimal\n';
            for (let i = 0; i < computedData.alphaValues.length; i++) {
                csv += `${computedData.alphaValues[i]},${computedData.spectrumData[i]},${computedData.alphaValues[i].toFixed(8)}\n`;
            }

            downloadCSV(csv, `spectrum_data_N${computedData.N}_${new Date().toISOString().split('T')[0]}.csv`);
            console.log('Spectrum CSV download initiated');
        }

        function exportMajorArcs() {
            console.log('Exporting major arcs data...');
            if (!computedData.majorData) {
                alert('Please generate visualization first!');
                return;
            }

            let csv = 'rational_alpha,sum_magnitude,numerator,denominator\n';
            for (let i = 0; i < computedData.majorLabels.length; i++) {
                const [num, den] = computedData.majorLabels[i].split('/').map(Number);
                csv += `${computedData.majorLabels[i]},${computedData.majorData[i]},${num},${den}\n`;
            }

            downloadCSV(csv, `major_arcs_N${computedData.N}_${new Date().toISOString().split('T')[0]}.csv`);
            console.log('Major arcs CSV download initiated');
        }

        function exportStatistics() {
            if (!computedData.N) {
                alert('Please generate visualization first!');
                return;
            }

            const stats = {
                metadata: {
                    generated_by: "Wessen Getachew",
                    twitter: "@7DView",
                    timestamp: computedData.timestamp,
                    tool: "Enhanced M√∂bius Distribution Explorer"
                },
                parameters: {
                    N: computedData.N,
                    sqrt_N: computedData.sqrtN,
                    resolution: computedData.alphaValues.length
                },
                mobius_statistics: {
                    positive_values: computedData.muStats.positive,
                    negative_values: computedData.muStats.negative,
                    zero_values: computedData.muStats.zero,
                    square_free_density: ((computedData.muStats.positive + computedData.muStats.negative) / computedData.N * 100)
                },
                extremal_analysis: {
                    maximum_sum_magnitude: computedData.maxSum,
                    optimal_alpha: computedData.bestAlpha,
                    deviation_ratio: computedData.ratio,
                    riemann_hypothesis_status: computedData.ratio < 2 ? "Good" : computedData.ratio < 5 ? "High" : "Very High"
                },
                spectrum_summary: {
                    mean_magnitude: computedData.spectrumData.reduce((a, b) => a + b, 0) / computedData.spectrumData.length,
                    median_magnitude: computedData.spectrumData.sort((a, b) => a - b)[Math.floor(computedData.spectrumData.length / 2)],
                    std_deviation: Math.sqrt(computedData.spectrumData.reduce((sum, val) => {
                        const mean = computedData.spectrumData.reduce((a, b) => a + b, 0) / computedData.spectrumData.length;
                        return sum + Math.pow(val - mean, 2);
                    }, 0) / computedData.spectrumData.length)
                }
            };

            downloadJSON(stats, `mobius_statistics_N${computedData.N}_${new Date().toISOString().split('T')[0]}.json`);
        }

        function exportFullReport() {
            if (!computedData.N) {
                alert('Please generate visualization first!');
                return;
            }

            const report = `# M√∂bius Sum Distribution Analysis Report
Generated by: Wessen Getachew (@7DView)
Date: ${new Date().toLocaleString()}
Tool: Enhanced M√∂bius Distribution Explorer

## Parameters
- N (Upper Limit): ${computedData.N.toLocaleString()}
- ‚àöN (Theoretical Bound): ${computedData.sqrtN.toFixed(4)}
- Grid Resolution: ${computedData.alphaValues.length} points

## M√∂bius Function Statistics
- Positive Œº(n): ${computedData.muStats.positive.toLocaleString()}
- Negative Œº(n): ${computedData.muStats.negative.toLocaleString()}
- Zero Œº(n): ${computedData.muStats.zero.toLocaleString()}
- Square-free Density: ${((computedData.muStats.positive + computedData.muStats.negative) / computedData.N * 100).toFixed(2)}%

## Extremal Analysis
- Maximum |S(N,Œ±)|: ${computedData.maxSum.toFixed(6)}
- Optimal Œ±: ${computedData.bestAlpha.toFixed(8)}
- Deviation Ratio (Max/‚àöN): ${computedData.ratio.toFixed(4)}
- RH Status: ${computedData.ratio < 2 ? 'Good (< 2‚àöN)' : computedData.ratio < 5 ? 'High (< 5‚àöN)' : 'Very High (‚â• 5‚àöN)'}

## Theoretical Context
The M√∂bius exponential sum S(N,Œ±) = Œ£_{n‚â§N} Œº(n) e^{2œÄi n Œ±} provides insights into:
- Distribution of square-free integers
- Connections to the Riemann Hypothesis
- Deviations from expected random behavior

Large values of |S(N,Œ±)| suggest non-random patterns in the distribution of Œº(n).
The Riemann Hypothesis predicts bounds related to ‚àöN for these sums.

---
Analysis completed at: ${new Date().toISOString()}
`;

            const blob = new Blob([report], { type: 'text/markdown' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = `mobius_analysis_report_N${computedData.N}_${new Date().toISOString().split('T')[0]}.md`;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }

        function exportChartImages() {
            if (!charts.spectrum) {
                alert('Please generate visualization first!');
                return;
            }

            // Export spectrum chart
            const spectrumCanvas = document.getElementById('spectrumChart');
            const spectrumLink = document.createElement('a');
            spectrumLink.download = `spectrum_chart_N${computedData.N}_${new Date().toISOString().split('T')[0]}.png`;
            spectrumLink.href = spectrumCanvas.toDataURL();
            spectrumLink.click();

            // Export major arcs chart
            setTimeout(() => {
                const majorCanvas = document.getElementById('majorChart');
                const majorLink = document.createElement('a');
                majorLink.download = `major_arcs_chart_N${computedData.N}_${new Date().toISOString().split('T')[0]}.png`;
                majorLink.href = majorCanvas.toDataURL();
                majorLink.click();
            }, 500);

            // Export histogram
            setTimeout(() => {
                const histCanvas = document.getElementById('histogramChart');
                const histLink = document.createElement('a');
                histLink.download = `histogram_chart_N${computedData.N}_${new Date().toISOString().split('T')[0]}.png`;
                histLink.href = histCanvas.toDataURL();
                histLink.click();
            }, 1000);
        }
        
        body { 
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; 
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
            color: white;
            animation: gradientShift 15s ease infinite;
            background-size: 300% 300%;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 30px 80px rgba(0,0,0,0.4);
            color: #2c3e50;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        h1 { 
            text-align: center; 
            margin-bottom: 15px;
            font-size: 3em;
            background: linear-gradient(45deg, #667eea, #764ba2, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 800;
            letter-spacing: -2px;
        }
        
        .subtitle {
            text-align: center;
            font-size: 1.3em;
            color: #6c757d;
            margin-bottom: 40px;
            font-style: italic;
            line-height: 1.6;
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
            padding: 30px;
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            border-radius: 20px;
            border: 3px solid rgba(102, 126, 234, 0.1);
            box-shadow: inset 0 4px 20px rgba(0,0,0,0.05);
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
        }
        
        label { 
            font-weight: 700; 
            margin-bottom: 10px; 
            color: #2c3e50;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        input, select, button {
            padding: 15px;
            border: 3px solid #e9ecef;
            border-radius: 12px;
            font-size: 15px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
        }
        
        input:focus, select:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 25px rgba(102, 126, 234, 0.3);
            transform: translateY(-2px);
        }
        
        button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 16px;
        }
        
        button:hover:not(:disabled) {
            transform: translateY(-4px);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
            background: linear-gradient(135deg, #5a6fd8, #6a4190);
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .chart-container {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            border: 2px solid #f1f3f4;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .chart-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 60px rgba(0,0,0,0.15);
        }
        
        .chart-container h3 {
            margin: 0 0 25px 0;
            color: #2c3e50;
            text-align: center;
            font-size: 1.4em;
            font-weight: 700;
            border-bottom: 4px solid #667eea;
            padding-bottom: 15px;
        }
        
        .chart-wrapper {
            position: relative;
            height: 380px;
        }
        
        .comparison-chart {
            grid-column: 1 / -1;
            height: 500px;
        }
        
        .advanced-chart {
            grid-column: 1 / -1;
            height: 600px;
        }
        
        .advanced-chart .chart-wrapper {
            height: 500px;
        }
        
        .three-d-container {
            width: 100%;
            height: 500px;
            border-radius: 12px;
            overflow: hidden;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 40px;
        }
        
        .stat-card {
            background: linear-gradient(145deg, white, #f8f9fa);
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 12px 35px rgba(0,0,0,0.08);
            border-left: 6px solid #667eea;
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
        }
        
        .stat-card h4 {
            margin: 0 0 20px 0;
            color: #2c3e50;
            font-size: 1.2em;
            font-weight: 700;
        }
        
        .stat-value {
            font-size: 2.2em;
            font-weight: 900;
            color: #667eea;
            margin-bottom: 8px;
            line-height: 1;
        }
        
        .stat-label {
            color: #6c757d;
            font-size: 0.95em;
            font-weight: 500;
        }
        
        .progress {
            width: 100%;
            height: 12px;
            background: #e9ecef;
            border-radius: 8px;
            margin: 20px 0;
            overflow: hidden;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb);
            width: 0%;
            transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 8px;
        }
        
        .math {
            font-style: italic;
            color: #8e44ad;
            font-family: 'Times New Roman', serif;
            font-weight: 600;
        }
        
        .rh-indicator {
            padding: 12px 20px;
            border-radius: 25px;
            font-weight: 700;
            text-align: center;
            margin: 15px 0;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .rh-good { 
            background: linear-gradient(135deg, #d4edda, #c3e6cb); 
            color: #155724; 
            border: 2px solid #28a745;
        }
        
        .rh-high { 
            background: linear-gradient(135deg, #fff3cd, #ffeaa7); 
            color: #856404; 
            border: 2px solid #ffc107;
        }
        
        .rh-very-high { 
            background: linear-gradient(135deg, #f8d7da, #f5c6cb); 
            color: #721c24; 
            border: 2px solid #dc3545;
        }
        
        .theory-info {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            padding: 25px;
            border-radius: 16px;
            margin: 30px 0;
            border-left: 6px solid #2196f3;
            font-size: 0.95em;
            line-height: 1.7;
        }
        
        .export-controls {
            background: linear-gradient(145deg, #e8f5e8, #d4edda);
            padding: 25px;
            border-radius: 16px;
            margin: 30px 0;
            border: 3px solid #28a745;
            display: none;
            width: 100%;
            box-sizing: border-box;
            position: relative;
            z-index: 10;
        }
        
        .export-controls.show {
            display: block !important;
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .export-controls h4 {
            color: #155724;
            font-weight: 700;
            margin: 0 0 20px 0;
            text-align: center;
        }
        
        .export-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .export-btn {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
        }
        
        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.3);
        }
        
        .author-credit {
            text-align: center; 
            margin-bottom: 20px; 
            font-size: 0.9em; 
            color: #6c757d;
        }
        
        .author-credit a {
            color: #667eea; 
            text-decoration: none;
            font-weight: 600;
        }
        
        .author-credit a:hover {
            text-decoration: underline;
        }
        
        .donation-section {
            background: linear-gradient(145deg, #fff3cd, #ffeaa7);
            border: 3px solid #ffc107;
            border-radius: 16px;
            padding: 25px;
            margin: 30px 0;
            text-align: center;
        }
        
        .donation-section h4 {
            color: #856404;
            font-weight: 700;
            margin: 0 0 20px 0;
            font-size: 1.3em;
        }
        
        .donation-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            align-items: center;
        }
        
        .donation-btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 15px 25px;
            border-radius: 12px;
            text-decoration: none;
            font-weight: 700;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .paypal-btn {
            background: linear-gradient(135deg, #0070ba, #003087);
            color: white;
        }
        
        .paypal-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(0, 112, 186, 0.4);
            background: linear-gradient(135deg, #005ea6, #002970);
        }
        
        .bitcoin-btn {
            background: linear-gradient(135deg, #f7931a, #e08916);
            color: white;
        }
        
        .bitcoin-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(247, 147, 26, 0.4);
            background: linear-gradient(135deg, #e08916, #cc7914);
        }
        
        .btc-address {
            background: rgba(0,0,0,0.05);
            padding: 10px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            word-break: break-all;
            margin-top: 10px;
            color: #333;
        }
        
        .donation-message {
            color: #856404;
            font-style: italic;
            margin-top: 15px;
            font-size: 0.95em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåå Enhanced M√∂bius Distribution Explorer</h1>
        <p class="subtitle">
            Deep visualization of <span class="math">S(N, Œ±) = Œ£<sub>n‚â§N</sub> Œº(n) e<sup>2œÄi n Œ±</sup></span> 
            for Riemann Hypothesis analysis
        </p>
        <div style="text-align: center; margin-bottom: 20px; font-size: 0.9em; color: #6c757d;">
            Created by <strong>Wessen Getachew</strong> | Follow on Twitter: <a href="https://twitter.com/7DView" target="_blank" style="color: #667eea; text-decoration: none;">@7DView</a>
        </div>
        
        <div class="donation-section">
            <h4>üíù Support Mathematical Research</h4>
            <p style="margin-bottom: 20px; color: #856404;">If this tool has helped your research or studies, consider supporting continued development!</p>
            <div class="donation-buttons">
                <a href="https://www.paypal.com/donate/?hosted_button_id=YOUR_BUTTON_ID&business=getachewwessen%40gmail.com&currency_code=USD" 
                   target="_blank" class="donation-btn paypal-btn">
                    üí≥ Donate via PayPal
                </a>
                <button onclick="showBitcoinAddress()" class="donation-btn bitcoin-btn">
                    ‚Çø Donate Bitcoin
                </button>
            </div>
            <div id="btcAddress" style="display: none;">
                <div class="btc-address">
                    bc1qtsuj9x372slcgead3tlnrpw0r6tu7y7y0xwuk4
                </div>
                <button onclick="copyBtcAddress()" style="margin-top: 10px; padding: 8px 16px; background: #f7931a; color: white; border: none; border-radius: 6px; cursor: pointer;">
                    üìã Copy Address
                </button>
            </div>
            <div class="donation-message">
                Your support enables advanced mathematical visualization tools and open-source research!
            </div>
        </div>
        
        <div class="theory-info">
            <h4>üßÆ What This Tool Does</h4>
            <p><strong>M√∂bius Function Œº(n):</strong> A number theory function where Œº(n) = 1 if n is square-free with an even number of prime factors, Œº(n) = -1 if n is square-free with an odd number of prime factors, and Œº(n) = 0 if n has a squared prime factor.</p>
            
            <p><strong>Exponential Sum S(N,Œ±):</strong> We compute S(N,Œ±) = Œ£<sub>n‚â§N</sub> Œº(n) e<sup>2œÄi n Œ±</sup> for different values of Œ±. This measures how the M√∂bius function behaves when combined with oscillatory exponential terms.</p>
            
            <p><strong>Riemann Hypothesis Connection:</strong> The RH predicts that |S(N,Œ±)| should typically be bounded by ‚àöN. Large deviations from this bound suggest interesting mathematical phenomena and potential connections to the distribution of prime numbers.</p>
            
            <p><strong>Major Arcs:</strong> These are rational values Œ± = a/q where the exponential sum often achieves its largest values due to resonance effects in the oscillatory terms.</p>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <label for="N">üî¢ N (Upper Limit)</label>
                <input type="number" id="N" value="300" min="50" max="3000" step="50">
            </div>
            
            <div class="control-group">
                <label for="resolution">üìä Grid Resolution</label>
                <select id="resolution">
                    <option value="64">64 points (fast)</option>
                    <option value="128">128 points</option>
                    <option value="256" selected>256 points</option>
                    <option value="512">512 points</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="vizType">üé® Visualization Type</label>
                <select id="vizType">
                    <option value="standard">Standard Charts</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="majorQ">üéØ Major Arc Q‚ÇÄ</label>
                <input type="number" id="majorQ" value="25" min="8" max="100">
            </div>
                <button onclick="generateVisualization()" id="generateBtn">
                    üöÄ Launch Mathematical Exploration
                </button>
                <div class="progress" id="progress" style="display: none;">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
            </div>
        </div>

        <div class="chart-grid" id="chartGrid" style="display: none;">
            <!-- Standard Charts Only -->
            <div class="chart-container" id="spectrumContainer">
                <h3>üåä Complete Spectrum Analysis</h3>
                <p style="font-size: 0.9em; color: #6c757d; margin-bottom: 15px; line-height: 1.6;">
                    <strong>What it shows:</strong> This chart displays |S(N,Œ±)| for all Œ± values from 0 to 1, revealing the complete oscillatory behavior of the M√∂bius exponential sum. Peaks indicate where the M√∂bius function has strong resonance with the exponential terms e^(2œÄi n Œ±). 
                    <br><br>
                    <strong>Mathematical significance:</strong> The red dashed line shows the ‚àöN theoretical bound predicted by the Riemann Hypothesis. Values exceeding this bound suggest deviations from expected random behavior and may indicate deep arithmetic structures in the distribution of square-free numbers.
                </p>
                <div class="chart-wrapper">
                    <canvas id="spectrumChart"></canvas>
                </div>
            </div>
            
            <div class="chart-container" id="majorContainer">
                <h3>üéØ Major Arc Resonances</h3>
                <p style="font-size: 0.9em; color: #6c757d; margin-bottom: 15px; line-height: 1.6;">
                    <strong>What it shows:</strong> This bar chart displays |S(N,Œ±)| specifically for rational values Œ± = a/q where gcd(a,q) = 1. These "major arcs" often produce the largest sum magnitudes due to arithmetic resonances between the M√∂bius function and the periodic structure of rational points.
                    <br><br>
                    <strong>Why it matters:</strong> Major arcs reveal how the distribution of square-free integers interacts with rational approximations. Large values here suggest strong correlations between the M√∂bius function and Diophantine properties, providing insights into both analytic number theory and the fine structure of arithmetic functions.
                </p>
                <div class="chart-wrapper">
                    <canvas id="majorChart"></canvas>
                </div>
            </div>
            
            <div class="chart-container comparison-chart" id="histogramContainer">
                <h3>üìà Statistical Distribution Analysis</h3>
                <p style="font-size: 0.9em; color: #6c757d; margin-bottom: 15px; line-height: 1.6;">
                    <strong>What it shows:</strong> This histogram reveals the frequency distribution of |S(N,Œ±)| values across all Œ±, showing how often different magnitudes occur. It tests whether the M√∂bius exponential sums follow expected random patterns or exhibit systematic deviations.
                    <br><br>
                    <strong>Statistical interpretation:</strong> A roughly normal or exponential distribution suggests random-like behavior consistent with theoretical predictions. Heavy tails or unusual clustering may indicate non-random structures, potentially related to deep conjectures about L-functions and the distribution of primes. The shape provides crucial evidence for or against various hypotheses in analytic number theory.
                </p>
                <div class="chart-wrapper">
                    <canvas id="histogramChart"></canvas>
                </div>
            </div>
        </div>


            <div class="stat-card">
                <h4>üìä Computational Parameters</h4>
                <div class="stat-value" id="statN">-</div>
                <div class="stat-label">N (Upper limit)</div>
                <div class="stat-value" id="statSqrtN">-</div>
                <div class="stat-label">‚àöN (RH theoretical bound)</div>
            </div>
            
            <div class="stat-card">
                <h4>üî¢ M√∂bius Function Stats</h4>
                <div class="stat-value" id="statNonZero">-</div>
                <div class="stat-label">Non-zero Œº(n) count</div>
                <div class="stat-value" id="statDensity">-</div>
                <div class="stat-label">Square-free density (%)</div>
            </div>
            
            <div class="stat-card">
                <h4>‚ö° Extremal Values</h4>
                <div class="stat-value" id="statMaxSum">-</div>
                <div class="stat-label">Maximum |S(N,Œ±)|</div>
                <div class="stat-value" id="statMaxAlpha">-</div>
                <div class="stat-label">Optimal Œ± coordinate</div>
            </div>
            
            <div class="stat-card">
                <h4>üß¨ RH Compliance Test</h4>
                <div class="stat-value" id="statRatio">-</div>
                <div class="stat-label">Max/‚àöN Deviation Ratio</div>
                <div class="rh-indicator" id="rhStatus">Computing analysis...</div>
            </div>
        </div>
    </div>

    <script>
        let charts = {};
        let computedData = {}; // Store all computed data for export

        // M√∂bius function sieve
        function mobiusSieve(N) {
            const mu = new Int8Array(N + 1);
            const lp = new Int32Array(N + 1);
            mu[1] = 1;
            const primes = [];
            
            for (let x = 2; x <= N; x++) {
                if (lp[x] === 0) {
                    lp[x] = x;
                    primes.push(x);
                    mu[x] = -1;
                }
                
                for (const p of primes) {
                    const y = p * x;
                    if (y > N) break;
                    lp[y] = p;
                    if (x % p === 0) {
                        mu[y] = 0;
                        break;
                    } else {
                        mu[y] = -mu[x];
                    }
                }
            }
            return mu;
        }

        // Compute M√∂bius exponential sum
        function computeSum(mu, alpha) {
            const N = mu.length - 1;
            let totalReal = 0.0;
            let totalImag = 0.0;
            
            for (let n = 1; n <= N; n++) {
                if (mu[n] !== 0) {
                    totalReal += mu[n] * Math.cos(2 * Math.PI * alpha * n);
                    totalImag += mu[n] * Math.sin(2 * Math.PI * alpha * n);
                }
            }
            
            return Math.sqrt(totalReal * totalReal + totalImag * totalImag);
        }

        // GCD function
        function gcd(a, b) {
            while (b !== 0) {
                const temp = b;
                b = a % b;
                a = temp;
            }
            return a;
        }

        function updateProgress(percent, status = '') {
            document.getElementById('progressBar').style.width = percent + '%';
            if (status) {
                document.getElementById('generateBtn').innerHTML = status;
            }
        }

        async function generateVisualization() {
            const N = parseInt(document.getElementById('N').value);
            const resolution = parseInt(document.getElementById('resolution').value);
            const Q0 = parseInt(document.getElementById('majorQ').value);
            const vizType = document.getElementById('vizType').value;
            
            const generateBtn = document.getElementById('generateBtn');
            const progress = document.getElementById('progress');
            
            generateBtn.disabled = true;
            progress.style.display = 'block';
            updateProgress(0, 'üîß Initializing computation...');

            try {
                // Generate M√∂bius function
                updateProgress(5, 'üßÆ Computing M√∂bius function...');
                const mu = mobiusSieve(N);
                const sqrtN = Math.sqrt(N);

                // Compute statistics
                const muStats = { positive: 0, negative: 0, zero: 0 };
                for (let i = 1; i <= N; i++) {
                    if (mu[i] > 0) muStats.positive++;
                    else if (mu[i] < 0) muStats.negative++;
                    else muStats.zero++;
                }

                updateProgress(10, 'üåä Analyzing spectrum...');

                // Full spectrum computation
                const spectrumData = [];
                const alphaValues = [];
                let maxSum = 0;
                let bestAlpha = 0;

                for (let j = 0; j < resolution; j++) {
                    const alpha = j / resolution;
                    const sumValue = computeSum(mu, alpha);
                    spectrumData.push(sumValue);
                    alphaValues.push(alpha);
                    
                    if (sumValue > maxSum) {
                        maxSum = sumValue;
                        bestAlpha = alpha;
                    }
                    
                    if (j % 20 === 0) {
                        updateProgress(10 + (j / resolution) * 40, 'üåä Analyzing spectrum...');
                        await new Promise(resolve => setTimeout(resolve, 1));
                    }
                }

                updateProgress(50, 'üéØ Computing major arcs...');

                // Major arcs computation
                const majorData = [];
                const majorLabels = [];
                let majorMax = 0;
                let bestRational = "";

                for (let q = 1; q <= Q0; q++) {
                    for (let a = 1; a <= q; a++) {
                        if (gcd(a, q) === 1) {
                            const alpha = a / q;
                            const sumValue = computeSum(mu, alpha);
                            majorData.push(sumValue);
                            majorLabels.push(`${a}/${q}`);
                            
                            if (sumValue > majorMax) {
                                majorMax = sumValue;
                                bestRational = `${a}/${q}`;
                            }
                        }
                    }
                }

                updateProgress(75, 'üìä Creating distributions...');

                // Create histogram data
                const histogramBins = 20;
                const maxVal = Math.max(...spectrumData);
                const binSize = maxVal / histogramBins;
                const histogram = new Array(histogramBins).fill(0);
                const histogramLabels = [];

                for (let i = 0; i < histogramBins; i++) {
                    histogramLabels.push(`${(i * binSize).toFixed(1)}-${((i + 1) * binSize).toFixed(1)}`);
                }

                spectrumData.forEach(value => {
                    const binIndex = Math.min(Math.floor(value / binSize), histogramBins - 1);
                    histogram[binIndex]++;
                });

                updateProgress(85, 'üìà Updating statistics...');

                // Update statistics
                const ratio = maxSum / sqrtN;
                document.getElementById('statN').textContent = N.toLocaleString();
                document.getElementById('statSqrtN').textContent = sqrtN.toFixed(2);
                document.getElementById('statNonZero').textContent = 
                    `${muStats.positive + muStats.negative}`;
                document.getElementById('statDensity').textContent = 
                    `${((muStats.positive + muStats.negative)/N * 100).toFixed(1)}`;
                document.getElementById('statMaxSum').textContent = maxSum.toFixed(4);
                document.getElementById('statMaxAlpha').textContent = bestAlpha.toFixed(6);
                document.getElementById('statRatio').textContent = ratio.toFixed(4);

                // RH status
                const rhStatus = document.getElementById('rhStatus');
                if (ratio < 2) {
                    rhStatus.textContent = '‚úÖ Good (< 2‚àöN)';
                    rhStatus.className = 'rh-indicator rh-good';
                } else if (ratio < 5) {
                    rhStatus.textContent = '‚ö†Ô∏è High (< 5‚àöN)';
                    rhStatus.className = 'rh-indicator rh-high';
                } else {
                    rhStatus.textContent = '‚ùå Very High (‚â• 5‚àöN)';
                    rhStatus.className = 'rh-indicator rh-very-high';
                }

                updateProgress(85, 'üé® Creating visualizations...');

                // Show/hide charts based on visualization type
                showVisualizationType(vizType);

                // Create charts based on type
                createSpectrumChart(alphaValues, spectrumData, sqrtN);
                createMajorChart(majorLabels.slice(0, 50), majorData.slice(0, 50), sqrtN);
                createHistogramChart(histogramLabels, histogram);

                updateProgress(100, '‚úÖ Analysis Complete');

                // Store computed data for export
                computedData = {
                    N: N,
                    sqrtN: sqrtN,
                    mu: mu,
                    muStats: muStats,
                    spectrumData: spectrumData,
                    alphaValues: alphaValues,
                    majorData: majorData,
                    majorLabels: majorLabels,
                    maxSum: maxSum,
                    bestAlpha: bestAlpha,
                    ratio: ratio,
                    histogram: histogram,
                    histogramLabels: histogramLabels,
                    timestamp: new Date().toISOString()
                };

                // Show results with export controls
                console.log('Showing results...');
                document.getElementById('chartGrid').style.display = 'grid';
                document.getElementById('statsGrid').style.display = 'grid';
                
                // Show export controls automatically after generation
                const exportControls = document.getElementById('exportControls');
                console.log('Export controls element:', exportControls);
                if (exportControls) {
                    exportControls.style.display = 'block';
                    exportControls.classList.add('show');
                    console.log('Export controls should now be visible');
                } else {
                    console.error('Export controls element not found!');
                }
                
                // Scroll to results
                document.getElementById('chartGrid').scrollIntoView({ behavior: 'smooth' });

            } catch (error) {
                alert('Error during computation: ' + error.message);
                console.error(error);
            } finally {
                generateBtn.disabled = false;
                generateBtn.innerHTML = 'üöÄ Launch Mathematical Exploration';
                setTimeout(() => {
                    progress.style.display = 'none';
                    updateProgress(0);
                }, 1000);
            }
        }

        function createSpectrumChart(alphas, values, sqrtN) {
            const ctx = document.getElementById('spectrumChart').getContext('2d');
            
            if (charts.spectrum) charts.spectrum.destroy();
            
            charts.spectrum = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: alphas.map(a => a.toFixed(3)),
                    datasets: [{
                        label: '|S(N,Œ±)|',
                        data: values,
                        borderColor: 'rgb(102, 126, 234)',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.1,
                        pointRadius: 0
                    }, {
                        label: '‚àöN baseline',
                        data: new Array(values.length).fill(sqrtN),
                        borderColor: 'rgb(231, 76, 60)',
                        borderWidth: 3,
                        borderDash: [5, 5],
                        fill: false,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: '|S(N,Œ±)|' }
                        },
                        x: {
                            title: { display: true, text: 'Œ±' }
                        }
                    },
                    plugins: {
                        legend: { display: true }
                    }
                }
            });
        }

        // Show/hide visualization containers based on type
        function showVisualizationType(type) {
            // Only show standard charts
            document.getElementById('spectrumContainer').style.display = 'block';
            document.getElementById('majorContainer').style.display = 'block';
            document.getElementById('histogramContainer').style.display = 'block';
        }

        function createMajorChart(labels, values, sqrtN) {
            const ctx = document.getElementById('majorChart').getContext('2d');
            
            if (charts.major) charts.major.destroy();
            
            charts.major = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '|S(N,a/q)|',
                        data: values,
                        backgroundColor: 'rgba(118, 75, 162, 0.8)',
                        borderColor: 'rgb(118, 75, 162)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: '|S(N,Œ±)|' }
                        },
                        x: {
                            title: { display: true, text: 'Œ± = a/q' }
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }

        function createHistogramChart(labels, counts) {
            const ctx = document.getElementById('histogramChart').getContext('2d');
            
            if (charts.histogram) charts.histogram.destroy();
            
            charts.histogram = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Frequency',
                        data: counts,
                        backgroundColor: 'rgba(26, 188, 156, 0.8)',
                        borderColor: 'rgb(26, 188, 156)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Count' }
                        },
                        x: {
                            title: { display: true, text: '|S(N,Œ±)| Range' }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Distribution of |S(N,Œ±)| Values'
                        },
                        legend: { display: false }
                    }
                }
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Enhanced M√∂bius Sum Distribution Visualizer initialized');
        });

        // Donation functions
        function showBitcoinAddress() {
            const btcDiv = document.getElementById('btcAddress');
            btcDiv.style.display = btcDiv.style.display === 'none' ? 'block' : 'none';
        }

        function copyBtcAddress() {
            const address = 'bc1qtsuj9x372slcgead3tlnrpw0r6tu7y7y0xwuk4';
            navigator.clipboard.writeText(address).then(function() {
                alert('Bitcoin address copied to clipboard!');
            }).catch(function() {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = address;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('Bitcoin address copied to clipboard!');
            });
        }

        // Toggle export controls visibility
        function toggleExportControls() {
            const exportControls = document.getElementById('exportControls');
            if (exportControls.style.display === 'none' || !exportControls.style.display) {
                exportControls.style.display = 'block';
                exportControls.classList.add('show');
                console.log('Export controls shown manually');
            } else {
                exportControls.style.display = 'none';
                exportControls.classList.remove('show');
                console.log('Export controls hidden manually');
            }
        }
    </script>
</body>
                  </html>
